<!DOCTYPE html>
<html class=''>

<head>
  <meta charset='UTF-8'>
  <meta name="robots" content="noindex">
  <title>Retaliate or Carry-on: Reactive Aggression Experiment</title>
  <link rel='stylesheet' type='text/css' href='lib/rc-rage.css'>

  <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js'></script>
  <script src='lib/jspsych-6.1.0/jspsych.js'></script>
  <script src='lib/jspsych-6.1.0/plugins/jspsych-instructions.js'></script>
  <script src='lib/jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js'></script>
  <script src='lib/jspsych-audio-keyboard-with-replay.js'></script>
  <script src='lib/jspsych-rc-rage.js'></script>
  <script src='lib/rc-rage_main.js'></script>
</head>

<body>
  <div>
    <span style="font-size: 24px;">
      <br><br>
      If you are seeing this message for <span style="color: rgb(255, 0, 0);">
        <b>more than 5 minutes</b></span>,<br>
      please screen-capture this screen and send the image to us.
      <br><br>
      <span style="font-size: 28px;">We are very sorry for the inconvenience.</span>
    </span>
  </div>

  <style>
    #display_stage_background {
      width: 100vw;
      background-color: white;
      z-index: -1;
    }

    #display_stage {
      position: relative;
      left: 1vw;
      top: 1vh;
      height: 98vh;
      width: 98vw;
      background-color: white;
      box-shadow: 1px 1px 1px #999;
      border-radius: 15px;
      z-index: 0;
      overflow-y: hidden;
      overflow-x: hidden;
    }
  </style>

  <div id='display_stage_background'></div>
  <div id='display_stage'></div>

</body>

<script>
  /* Adaptat sense fullscreen */
  var instr_url = 'instruction/';
  var instr_imglist = get_instruction_imglist(instr_url, 30);

  var jspsych_session = [];

  jspsych_session.push({
    timeline: generate_instruction_block(instr_imglist)
  });

  jspsych_session.push({
    timeline: generate_practice_block()
  });

  jspsych_session.push({
    timeline: generate_main_block()
  });

  jspsych_session.push({
    type: "html-keyboard-response",
    stimulus: function () {
      let bonus = (main_score / 100).toFixed(2);
      let trial_seq = main_seq.map(item => (item > 1000 ? -1 : item)).toString().replace(/,/g, ';');
      let click_cnt = click_history.reduce((a, b) => a + b).toString();
      var comp_trial_cnt = wasted_click_history.filter(x => x >= 0).length;
      var provoked_cnt = main_seq.slice(0, comp_trial_cnt).filter(x => x > 0).length;
      var kill_cnt = wasted_click_history.filter(x => x > 0).length;

      return "<div class = centerbox><p><p>" +
        "<p class = block-text>Your performance-based bonus: $" + bonus + "</p>" +
        "<p class = block-text>Number of completed trials: " + comp_trial_cnt + " out of " + main_seq.length + "</p>" +
        "<p class = block-text>Number of provocations: " + provoked_cnt + "</p>" +
        "<p class = block-text>Number of retaliations: " + kill_cnt + "</p>" +
        "<p class = block-text>Press any key to complete the experiment. Thank you!</p></div>";
    }
  });

  jsPsych.init({
    display_element: 'display_stage',
    timeline: jspsych_session,
    preload_images: instr_imglist,
    on_finish: function () {
      console.log(result_string);
      var display_element = jsPsych.getDisplayElement();
      display_element.innerHTML =
        "Results will be stored as a single string variable with a csv-like formatting<br>" +
        "so that it can easily be saved into Qualtrics Embedded Data.<p>" +
        "delimiter - space (' '), newline - semicolon (';')<p>" +
        "<b>Result string ==></b> " + result_string;
    }
  });
</script>

</html>
